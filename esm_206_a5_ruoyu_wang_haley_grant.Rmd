---
output: html_document
---
# Pacific giant salamanders in Mack Creek Abundance and weight among different channels and forest situations

#### Ruoyu Wang & Haley Grant

#### 11/22/2019

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.align = "center")

# Attach necessary packages
library(tidyverse)
library(janitor)
library(ggbeeswarm)
library(car)
library(kableExtra)
library(janitor)
library(broom)
library(ggpubr)
library(DT)
library(viridisLite)
library(effsize)
library(knitr)

# Read in raw data
mack_creek_df <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  filter(species == "DITE")
```


### Introduction

This report compares the weights and abundance of Pacific giant salamanders in Mack Creek (near Blue River, Oregon). The area is composed of Clear Cut (c. 1963) and 500-year-old coniferous Old Growth forests. Within the two sections of forests, salamanders are found in Cascades, Pools and Side-Channels. We wanted to see where salamanders are found the most, and if the section of Forrest- Clear Cut or Old Growth- has an affect on their location. This report does not include Salamanders found in Isolated Pools, as these areas are separated from the creek and not the focus of this report.

--> add why studying this is important

```{r  out.width = "60%"}
knitr::include_graphics("Dicamptodon_tenebrosus_2.JPG") 
```

***Figure. 1*** *Pacific giant salamander (Dicamptodon tenebrosus). Credit: Jeffrey Marsten. [Wikipedia](https://commons.wikimedia.org/wiki/File:Dicamptodon_tenebrosus_2.JPG).*

### Data and Methods

The [data set](https://portal.lternet.edu/nis/mapbrowse?packageid=knb-lter-and.4027.12) was provided by the study "Aquatic Vertebrate Population Study in Mack Creek," by authors Stanley V. Gregory and the Andrews Forest LTER Site. The study monitored populations of West Slope cutthroat trout (Onchorhyncus clarki clarki) since 1987, as well as Pacific giant salamanders (Dicamptodon tenebrosus) beginning in 1993. This report uses their data to visualize annual counts of salamanders between Clear Cut and Old Growth sections from 1987 to present to show changes in populations. We used Chi-Square, t-test, as well as One-Way ANOVA to determine if there were significant differences in counts or weights of salamanders across sections (Clear Cut or Old Growth) and channel classifications (Cascades, Pools or Side-Channels).      

```{r  out.width = "60%"}
include_graphics("mack_creek_map_3.png") 
```


***Figure. 2*** *Map of Mack Creek, Oregon. Courtesy of [Google Maps](https://www.google.com/maps/place/44°13'17.3%22N+122°10'04.8%22W/@44.8758978,-124.1058318,7.57z/data=!4m5!3m4!1s0x0:0x0!8m2!3d44.2214667!4d-122.168!5m1!1e4?hl=en-US).*

### Results

#### A. Annual salamander population in two forest sections of Mack Creek. 

From 2012 to 2018, the total amount of Pacific giant salamanders has changed in different trends in two different forest sections: clear cut and old growth area  (Figure.3).

```{r compare_counts_sections}
# Find the counts of pacific giant salamander at OG and CC
mack_creek_a <- mack_creek_df %>% 
# filter(!notes == "Recap") %>% whether to minus these data or not
  group_by(year, section) %>% 
  summarize(
    total_count = n()
    )

# Made a colorblind-friendly palette.
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#0072B2", "#CC79A7")

# Visualize the results
ggplot(data = mack_creek_a, 
       aes(x = year, y = total_count, 
           color = section, pch = section)) +
  geom_point(show.legend = FALSE,
             size = 3) +
  geom_line(show.legend = FALSE,
             width = 1) +
  labs(x = "Year",
       y = "Annual population in forest setions")+
  annotate("text", 
           x = c(2018.5,2019), 
           y = c(380, 335), 
           label = c("Clear Cut", "Old Growth"),
           color = c("#E69F00", "#56B4E9"),
           fontface =2)+
  scale_color_manual(values = cbPalette) +
  scale_x_continuous(limits  = c(1993,2019.5),
                     breaks = c(1993, 1998, 2003, 2008, 2013, 2017))+
  theme_minimal() 

```
***Figure. 3*** *Data: .*

#### B. Salamander abundance by channel classification and forest sections in 2017.

Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek.

***Table. 1*** *Summary table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek. Data: .* 

```{r ruoyu_result_b}
# Find the counts of salamander by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek in year 2017.
salam_channel_count <- mack_creek_df %>% 
  filter(unittype %in% c("C", "P", "SC")) %>% 
  filter(year == "2017") %>% 
  group_by(unittype, section) %>% 
  summarize(
    count = n()
  ) %>% 
  mutate(section = ifelse(
    section == "OG",
    "Old Growth",
    "Clear Cut"
  ))

# Change the dataframe into wide format.
channel_section_table <- salam_channel_count %>% 
  pivot_wider(names_from = unittype, values_from = count) 

# Calculate the propotions within the dataframe.
channel_section_props <- channel_section_table %>% 
  janitor::adorn_percentages(denominator = "col") %>% 
  # not sure the denomincator should be the column or the row
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front") 

# Put the results in a nice kable.
channel_section_props %>% 
  kable(
    col.names = c("Section", "Cascades","Pool", "Side Channel"),
    align = "cccc"
  ) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center") %>% 
  add_header_above(c("Salamander counts by channel and sections classification in 2017" = 4))

```

#### C. Association between channel classifications and forest sections on mean salamanders weights.

Is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)? 

We use chi square test to compare proportions.

Null hypothesis: No association between channel classification and different forest sections. It is independent between the variables.

alternative hypothesis: association between variables

```{r result_c_chi_test}
# Chi-square test for independence

# A. First, get just a contingency table of counts we just want the four count values in a df, nothing else: 
salam_chi_counts <- channel_section_table %>% 
  select(-section)

# B. Run a chi-square test
my_salam_chi <- chisq.test(salam_chi_counts)

```

the channel location and two sections are independent. 
Since p > 0.05, we retain the null hypothesis that channel locations and sampling sections are independent. In other words: "There are no significant differences in forest condition (clear cut / old growth) based on where in the channels salamanders are found ($\chi$^2^(`r my_salam_chi$parameter`) = `r round(my_salam_chi$statistic,2)`, *p* (`r round(my_salam_chi$p.value,3)`) > 0.05)."

#### D. The influence of forest sections on Pacific giant salamanders weights.

Only considering creek section (OG or CC) as a variable (not further factoring by channel classification), answer: Is there a significant difference in mean weights for Pacific giant salamanders observed in the two forest sections (CC and OG) in 2017?

```{r result_d}
# Specify the data to be tested
mack_creek_d <- mack_creek_df %>%
  filter(year == 2017) %>% 
  select(section, weight)

# Summary table for different sections of forest.
forest_summary_table <- mack_creek_d %>% 
  group_by(section) %>% 
  summarize(
    mean = mean(weight, na.rm = TRUE),
    sd = sd(weight, na.rm = TRUE),
    count = n()
  )

# Visulize the two groups of data
ggplot()+
  geom_histogram(data = mack_creek_d,
                 aes(x = weight, 
                     fill = section,
                     color = section),
               show.legend = FALSE,
               alpha = 0.4,
               binwidth = 1)+
  labs(x = "Weight (g)", y = "Count")+
  geom_vline(data = forest_summary_table,
             aes(xintercept = mean,
                 colour = section),
             linetype = "dashed",
             size = 1,
             show.legend = FALSE)+
  scale_y_discrete(expand = c(0,0)) +
  scale_color_manual(values = cbPalette) +
  annotate("rect", xmin = 53, xmax = 77, 
           ymin = 54, ymax = 82, 
           fill = "white",
           color = "grey40",
           alpha = 0) +
  annotate("text", x = 65, y = 78, 
           label = "Sections", 
           size = 6, color = "black") + 
  annotate("text", x = 68: 68, y = c(60, 70), 
           label = c("Clear cut", "Old growth"), 
           size = 5, color = c("#E69F00", "#56B4E9")) +  
  annotate("rect", xmin = 55, xmax = 60, 
           ymin = 57, ymax = 62, 
           fill = "#E69F00",
           color = "#E69F00",
           alpha = 0.4) +
  annotate("rect", xmin = 55, xmax = 60, 
           ymin = 67, ymax = 72, 
           fill = "#56B4E9",
           color = "#56B4E9",
           alpha = 0.4) +
  theme_minimal()
```
***Figure. 4*** *Data: .*

```{r result_d_ttest}
# Perform a t.test
# null hypothesis: means are equal (difference in means = 0)
# alternative hypothesis: means are not equal

sectiont_ttest <- t.test(data = mack_creek_d, weight~section)

# effect size with cohen's d
section_d <- effsize::cohen.d(data = mack_creek_d, weight~section, na.rm = TRUE)

```

In year 2017, mean weight of Pacific giant salamanders (g) measured in clear cut forests (`r round(forest_summary_table$mean[1], 2)` $\pm$ `r round(forest_summary_table$sd[1], 2)`, n = `r forest_summary_table$count[1]`) did not have significant difference from the average salamander weight in old growth froest areas (`r round(forest_summary_table$mean[2], 2)` $\pm$ `r round(forest_summary_table$sd[2], 2)`, n = `r forest_summary_table$count[2]`) by a unpaired two-sample t-test (t(`r round(sectiont_ttest$parameter, 2)`) = `r round(sectiont_ttest$statistic, 2)`, *p*(`r round(sectiont_ttest$p.value, 3)`) > 0.05). The difference in mean weight between the two groups is 1.20 mm, with a negligible effect size (Cohen's d = `r round(section_d$estimate, 2)`). Therefore, we consider the salamander weights in clear cut areas were not significantly different from old growth ones. Histogram presented in Figure.2.

#### E. The influence of channel classfications on Pacific giant salamanders weights.

```{r result_e_data_wrangling}

# Only consider the channel type as a factor here
mack_creek_e <- mack_creek_df %>%
  filter(year == 2017) %>% 
  filter(unittype %in% c("C","P","SC")) %>% 
  select(weight, unittype) %>% 
  mutate(unittype = case_when(
    unittype == "C" ~ "Cascade",
    unittype == "P" ~"Pool",
    TRUE ~ "Side Channel"
  )) 

# Create a summary table
channel_summary_table <- mack_creek_e %>% 
  group_by(unittype) %>% 
  summarize(
    mean = mean(weight, na.rm = TRUE),
    sd = sd(weight, na.rm = TRUE),
    se = sd(weight, na.rm = TRUE) / sqrt(n()),
    var = var(weight, na.rm = TRUE),
    count = n()
  )
```

**1. Visually compare Pacific giant salamander weights between the three channel classifications.**

```{r result_e_weights_graph}
# make a graph
ggplot() +
  geom_beeswarm(data = mack_creek_e,
                aes(x = unittype, 
                    y = weight,
                    color = unittype),
              width = 0.2,
              alpha = 0.5,
              show.legend = FALSE) +
  labs(y = "Weight (g)",
       x = "Channel classifications") + 
  geom_errorbar(data = channel_summary_table,
                aes(x = unittype,
                    ymin = mean - sd,
                    ymax = mean + sd),
                color = "grey35",
                size = 0.7,
                width = 0.1)+
    geom_point(data = channel_summary_table,
             aes(x = unittype,
                 y = mean),
             color = "grey30",
             size = 3,
             show.legend = FALSE)+
 # geom_hline(data = channel_summary_table,
 #           aes(yintercept = mean,
 #              colour = unittype),
 #         linetype = "dashed",
 #        size = 0.6,
 #       show.legend = FALSE)+
  scale_color_manual(values = c("#009E73", "#0072B2", "#CC79A7"))+
  theme_minimal()+
  coord_flip()

```
***Figure. 5*** *The grey points showed the mean weights within each channel groups, the error bar indicates the standard diviation of the data. Data: .*

**2. Is there a significant difference in mean weights for Pacific giant salamanders observed in pools vs. cascades vs. side-channels in 2017?**

```{r result_e_check_variance}

# check variances
channel_summary_table %>% 
  kable(col.names = c("Channel", "Mean","Standard Deviation","Standard Error","Variance", "Sample Size"),
        align = "cccccc",
        digits = 2
        ) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center",
                row_label_position = c
                )%>% 
  add_header_above(c("Channel mean weight (g) Summary Table" = 6))

```

largest variance (Pool) (185.58), smallest variance (Side-Channel) (68.31). The largest variance needs to be smaller than at least 4 times the smallest variance to be considered close enough.  

```{r result_e_levene_test}
# Levene's statistical test for equal variance:

levene_test_e <- leveneTest(weight ~ unittype, data = mack_creek_e)
levene_test_e
# not significant, retain null hypothesis meaning that there is no significate difference between the variances between different groups.
```

Through Levene's test for homogeneity of variance, there is no 

```{r result_e_anova}
# Run one-way ANOVA to compare group means

# null hypothesis: no significant difference across groups
# alternative hypothesis: significant difference across groups

aov_e <- aov(weight ~ unittype, data = mack_creek_e)

# There is significant difference in means across groups.

# run post-hoc Tukey's

post_hoc_e <- TukeyHSD(aov_e)

# SC-P is significantly different. 

# reporting outcomes

aov_e_outcomes <- unlist(summary(aov_e))
```


Of the three groups, mean salamander weight differed significantly between side channels and pools (one-way ANOVA with post-hoc Tukey's HSD, F(`r aov_e_outcomes[1]`, `r aov_e_outcomes[2]`) = `r round(aov_e_outcomes[7],2)`, *p* = `r round(aov_e_outcomes[9],3)`).

```{r ANOVA_effect_size_cohens_d}
# pairwise cohen's d tests

# compairing Side Channel - Pool
# filter channels

side_channel_pool_e <- mack_creek_e %>%
  filter(unittype %in% c("Pool", "Side Channel"))

# cohen's d test

cohen_d_side_channel_pool <- cohen.d(data = side_channel_pool_e, weight~unittype)

cohen_d_side_channel_pool
```

The effect size was small between Side Channel and Pool samples: `r cohen_d_side_channel_pool$estimate`.

```{r ANOVA_effect_size_means}
# calculate samples means for pool and side channel

pool_weight <- mack_creek_e %>% 
  filter(unittype == "Pool")

pool_mean <- mean(pool_weight$weight)

side_channel_weight <- mack_creek_e %>%
  filter(unittype == "Side Channel")

side_channel_mean <- mean(side_channel_weight$weight)

means_difference_P_SC <- pool_mean - side_channel_mean

means_difference_P_SC

```

The actual difference of mean weights between salamanders found in Pools and salamanders equals `r means_difference_P_SC`

**3. Limits about comparing means across the groups.**

Mean is a measurement that is easily swayed by outliers, and it looks like the data has significant outliers. It may be more beneficial to also compare medians as well to make sure that outliers aren't influencing our result too much. This could be done through rank-based tests. 

### Summary

- 
-
-

### References 

Gregory S. V. 2016. Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702.



